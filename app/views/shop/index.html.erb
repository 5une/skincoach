<div class="min-h-screen bg-gray-50">
  <!-- Header -->
  <header class="bg-white shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center py-6">
        <div class="flex items-center">
          <h1 class="text-2xl font-bold text-gray-900">üß¥ SkinCoach Shop</h1>
          <p class="ml-4 text-gray-600 hidden sm:block">AI-Powered Skincare Recommendations</p>
        </div>
        <div class="flex items-center space-x-4">
          <%= link_to consultations_path, class: "bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors" do %>
            üì∏ Skin Analysis
          <% end %>
        </div>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="bg-gradient-to-r from-blue-600 to-purple-700 text-white py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 class="text-4xl font-bold mb-4">Discover Your Perfect Skincare Routine</h2>
      <p class="text-xl mb-8 opacity-90">AI-powered recommendations for your unique skin needs</p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <button onclick="document.getElementById('skincoach-photo-btn').click()" class="bg-white text-blue-600 px-8 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors">
          üì∏ Analyze Your Skin
        </button>
        <button onclick="document.getElementById('skincoach-input').focus()" class="border-2 border-white text-white px-8 py-3 rounded-lg font-semibold hover:bg-white hover:text-blue-600 transition-colors">
          üí¨ Ask Skincare Questions
        </button>
      </div>
    </div>
  </section>

  <!-- Filters & Search -->
  <section class="bg-white border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <%= form_with url: shop_index_path, method: :get, local: true, class: "flex flex-col lg:flex-row gap-4 items-center" do |f| %>
        <!-- Search -->
        <div class="flex-1 min-w-0">
          <%= f.text_field :search, value: params[:search], placeholder: "Search products, ingredients, or concerns...", 
              class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
        </div>
        
        <!-- Category Filter -->
        <div>
          <%= f.select :category, options_for_select([['All Categories', '']] + @categories.map{|c| [c.humanize, c]}, params[:category]),
              {}, { class: "px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" } %>
        </div>
        
        <!-- Brand Filter -->
        <div>
          <%= f.select :brand, options_for_select([['All Brands', '']] + @brands.map{|b| [b, b]}, params[:brand]),
              {}, { class: "px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" } %>
        </div>
        
        <!-- Sort -->
        <div>
          <%= f.select :sort, options_for_select([
              ['Name A-Z', ''],
              ['Price Low-High', 'price_low'],
              ['Price High-Low', 'price_high'],
              ['Brand', 'brand']
            ], params[:sort]),
            {}, { class: "px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" } %>
        </div>
        
        <!-- Search Button -->
        <div>
          <%= f.submit "Filter", class: "bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors cursor-pointer" %>
        </div>
      <% end %>
    </div>
  </section>

  <!-- Products Grid -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-lg font-semibold text-gray-900">
        <%= @products.count %> Products
        <% if params[:category].present? || params[:brand].present? || params[:search].present? %>
          <span class="text-gray-500">
            <% if params[:search].present? %>
              for "<%= params[:search] %>"
            <% end %>
            <% if params[:category].present? %>
              in <%= params[:category].humanize %>
            <% end %>
            <% if params[:brand].present? %>
              by <%= params[:brand] %>
            <% end %>
          </span>
        <% end %>
      </h3>
      
      <% if params[:category].present? || params[:brand].present? || params[:search].present? %>
        <%= link_to "Clear Filters", shop_index_path, class: "text-blue-600 hover:text-blue-800" %>
      <% end %>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      <% @products.each do |product| %>
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow">
          <!-- Product Image Placeholder -->
          <div class="h-48 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
            <% if product.image_url.present? %>
              <img src="<%= product.image_url %>" alt="<%= product.name %>" class="h-full w-full object-cover">
            <% else %>
              <div class="text-gray-400 text-center">
                <div class="text-4xl mb-2">üß¥</div>
                <div class="text-sm"><%= product.category.humanize %></div>
              </div>
            <% end %>
          </div>
          
          <!-- Product Info -->
          <div class="p-4">
            <div class="mb-2">
              <span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">
                <%= product.category.humanize %>
              </span>
              <% if product.comedogenic_rating.present? %>
                <span class="inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full ml-1">
                  Rating: <%= product.comedogenic_rating %>/5
                </span>
              <% end %>
            </div>
            
            <h4 class="font-semibold text-gray-900 mb-1 line-clamp-2"><%= product.name %></h4>
            <p class="text-sm text-gray-600 mb-2"><%= product.brand %></p>
            
            <% if product.price.present? %>
              <p class="text-lg font-bold text-gray-900 mb-2">
                <%= product.currency || 'USD' %> $<%= product.price %>
              </p>
            <% end %>
            
            <% if product.key_ingredients.present? %>
              <p class="text-xs text-gray-500 mb-2">
                <strong>Key Ingredients:</strong> <%= truncate(product.key_ingredients, length: 100) %>
              </p>
            <% end %>
            
            <% if product.skin_concerns.present? %>
              <p class="text-xs text-gray-500 mb-3">
                <strong>For:</strong> <%= product.skin_concerns %>
              </p>
            <% end %>
            
            <div class="flex gap-2">
              <% if product.product_url.present? %>
                <%= link_to "View Product", product.product_url, target: "_blank", 
                    class: "flex-1 bg-blue-600 text-white text-center py-2 px-3 rounded text-sm hover:bg-blue-700 transition-colors" %>
              <% end %>
              <button onclick="askAboutProduct('<%= product.name %>', '<%= product.category %>')" 
                      class="bg-gray-100 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-200 transition-colors">
                üí¨ Ask AI
              </button>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    
    <% if @products.empty? %>
      <div class="text-center py-12">
        <div class="text-6xl mb-4">üîç</div>
        <h3 class="text-xl font-semibold text-gray-900 mb-2">No products found</h3>
        <p class="text-gray-600 mb-4">Try adjusting your filters or search terms</p>
        <%= link_to "Clear Filters", shop_index_path, class: "text-blue-600 hover:text-blue-800" %>
      </div>
    <% end %>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-8 mt-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <p>&copy; 2025 SkinCoach. AI-powered skincare recommendations.</p>
      <p class="text-gray-400 mt-2">Upload a photo or ask questions for personalized advice.</p>
    </div>
  </footer>
</div>

<!-- Include SkinCoach Widget -->
<script src="/skincoach-widget.js"></script>
<script>
  // Initialize the widget
  document.addEventListener('DOMContentLoaded', function() {
    SkinCoach.init();
  });
  
  // Helper function to ask about specific products
  function askAboutProduct(productName, category) {
    const input = document.getElementById('skincoach-input');
    if (input) {
      input.value = `Tell me about ${productName} - is it good for my skin?`;
      input.focus();
    }
  }
</script>
